<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alto Contraste Pro - Centro Perceptum</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Montserrat', sans-serif; overflow: hidden; touch-action: none; }
        
        #game-ui { position: fixed; top: 20px; width: 100%; display: flex; justify-content: space-around; z-index: 10; font-size: 1.5rem; }
        .heart { color: #fff; text-shadow: 0 0 10px #fff; }

        #target { 
            position: absolute; cursor: pointer; display: flex; align-items: center; justify-content: center;
            background: #fff; border-radius: 15px; user-select: none;
        }

        #start-screen, #end-screen {
            position: fixed; inset: 0; background: #000; z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; border: 15px solid #fff;
        }

        .btn { background: #fff; color: #000; border: none; padding: 20px 50px; font-weight: 900; font-size: 1.8rem; cursor: pointer; margin-top: 30px; }
        
        .recommendation { background: #fff; color: #000; padding: 25px; margin: 20px; font-size: 1.2rem; max-width: 80% }
    </style>
</head>
<body>

<div id="start-screen">
    <h1 style="font-size: 3.5rem;">ALTO CONTRASTE</h1>
    <p style="font-size: 1.2rem;">MODO INFINITO - 3 VIDAS</p>
    <button class="btn" onclick="startGame()">INICIAR SESI√ìN</button>
</div>

<div id="game-ui" style="display:none;">
    <div>NIVEL: <span id="lvl">1</span></div>
    <div id="lives-container">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
</div>

<div id="target" style="display:none;" onclick="hit()"></div>

<div id="end-screen" style="display:none;">
    <h1>SESI√ìN FINALIZADA</h1>
    <div class="recommendation" id="resumen">Enviando resultados al historial...</div>
    <button class="btn" onclick="location.reload()">REINTENTAR</button>
</div>

<script>
    // TU URL DE GOOGLE APPS SCRIPT
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzZca1mPz6VPxF9fjyL4kWNup_TR9ULFXQCkB1a6BtxZRf3HgVjAjOsmQz2QnGMtPMAw/exec";

    let lives = 3;
    let level = 1;
    let hits = 0;
    let size = 250;
    let timer;
    const icons = ['‚ö™', '‚¨ú', '‚≠ê', 'üëÅÔ∏è', 'üéØ', '‚ûï'];

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'flex';
        spawn();
    }

    function spawn() {
        clearTimeout(timer);
        const target = document.getElementById('target');
        target.style.display = 'flex';
        
        // Ajuste de tama√±o por nivel
        let currentSize = Math.max(50, size - (level * 10));
        target.style.width = currentSize + 'px';
        target.style.height = currentSize + 'px';
        target.innerHTML = `<span style="font-size: ${currentSize * 0.6}px">${icons[Math.floor(Math.random()*icons.length)]}</span>`;

        const maxX = window.innerWidth - currentSize;
        const maxY = window.innerHeight - currentSize - 100;
        target.style.left = Math.random() * maxX + 'px';
        target.style.top = (Math.random() * maxY + 80) + 'px';

        // Tiempo l√≠mite para tocar (se vuelve m√°s r√°pido cada nivel)
        let timeLimit = Math.max(800, 3000 - (level * 150));
        timer = setTimeout(miss, timeLimit);
    }

    function hit() {
        hits++;
        if (hits % 4 === 0) {
            level++;
            document.getElementById('lvl').innerText = level;
        }
        spawn();
    }

    function miss() {
        lives--;
        updateLives();
        if (lives <= 0) endGame();
        else spawn();
    }

    function updateLives() {
        document.getElementById('lives-container').innerText = "‚ù§Ô∏è".repeat(lives) + "üñ§".repeat(3 - lives);
    }

    function endGame() {
        clearTimeout(timer);
        document.getElementById('target').style.display = 'none';
        document.getElementById('end-screen').style.display = 'flex';
        
        let rec = "";
        if (level > 8) rec = "Excelente agudeza visual din√°mica y fijaci√≥n. Umbral de contraste √≥ptimo.";
        else if (level > 4) rec = "Capacidad visual funcional. Se recomienda seguir trabajando para disminuir el tama√±o del est√≠mulo.";
        else rec = "Atenci√≥n visual l√°bil. Requiere fortalecer la fijaci√≥n central con est√≠mulos de mayor tama√±o.";

        document.getElementById('resumen').innerText = rec;

        // ENV√çO AL EXCEL
        const datos = {
            paciente: localStorage.getItem('paciente') || "Sin Nombre",
            juego: "Alto Contraste Infinito",
            puntuacion: hits,
            nivel: level,
            recomendacion: rec
        };

        fetch(WEBAPP_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify(datos)
        });
    }
</script>
</body>
</html>

