<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alto Contraste Pro - Centro Perceptum</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Montserrat', sans-serif; overflow: hidden; touch-action: none; }
        
        /* UI SUPERIOR */
        #game-ui { 
            position: fixed; top: 0; width: 100%; background: rgba(255,255,255,0.1); 
            padding: 15px; display: none; justify-content: space-around; align-items: center; z-index: 10; 
        }
        #timer-bar-container { width: 40%; height: 10px; background: #333; border-radius: 5px; overflow: hidden; }
        #timer-bar { width: 100%; height: 100%; background: #fff; transition: width 0.1s linear; }

        /* OBJETIVO: Figura Blanca sobre Negro */
        #target { 
            position: absolute; cursor: pointer; display: flex; align-items: center; justify-content: center;
            background: transparent; user-select: none; color: #fff;
        }

        /* PANTALLAS */
        #start-screen, #end-screen {
            position: fixed; inset: 0; background: #000; z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; border: 15px solid #fff; padding: 20px;
        }

        .instructions-box { 
            border: 2px solid #fff; padding: 25px; margin: 20px; max-width: 600px; text-align: left; 
        }

        .btn { background: #fff; color: #000; border: none; padding: 20px 50px; font-weight: 900; font-size: 1.5rem; cursor: pointer; margin-top: 20px; text-transform: uppercase; }
        
        .recommendation { background: #fff; color: #000; padding: 25px; margin-top: 20px; font-size: 1.1rem; max-width: 80% }
    </style>
</head>
<body>

<div id="start-screen">
    <h1 style="font-size: 3rem; margin: 0;">CENTRO PERCEPTUM</h1>
    <div class="instructions-box">
        <h2 style="margin-top:0;">ALTO CONTRASTE PEDI√ÅTRICO</h2>
        <p><strong>Habilidades:</strong> Fijaci√≥n, Agudeza visual b√°sica y Atenci√≥n focalizada.</p>
        <p><strong>Instrucci√≥n:</strong> Toca las figuras blancas que aparecen. El tama√±o ir√° disminuyendo progresivamente para trabajar la agudeza del est√≠mulo.</p>
        <p><strong>Modo:</strong> Infinito (3 vidas)</p>
    </div>
    <button class="btn" onclick="startGame()">¬°EMPEZAR!</button>
</div>

<div id="game-ui">
    <div>NIVEL: <span id="lvl">1</span></div>
    <div id="timer-bar-container"><div id="timer-bar"></div></div>
    <div id="lives-container">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
</div>

<div id="target" style="display:none;" onclick="hit()"></div>

<div id="end-screen" style="display:none;">
    <h1>SESI√ìN FINALIZADA</h1>
    <div class="recommendation" id="resumen">Enviando resultados al historial cl√≠nico...</div>
    <button class="btn" onclick="location.reload()">NUEVA SESI√ìN</button>
</div>

<script>
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzZca1mPz6VPxF9fjyL4kWNup_TR9ULFXQCkB1a6BtxZRf3HgVjAjOsmQz2QnGMtPMAw/exec";

    let lives = 3;
    let level = 1;
    let hits = 0;
    let baseSize = 350; // Empezamos mucho m√°s grande
    let timerInterval;
    let timeLeft;
    const icons = ['‚òÖ', '‚óè', '‚ñ†', '‚ñ≤', '‚ú¶', '‚úñ'];

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'flex';
        spawn();
    }

    function spawn() {
        clearInterval(timerInterval);
        const target = document.getElementById('target');
        target.style.display = 'flex';
        
        // El tama√±o se reduce 25px por cada nivel
        let currentSize = Math.max(40, baseSize - (level * 25));
        target.style.width = currentSize + 'px';
        target.style.height = currentSize + 'px';
        target.style.fontSize = (currentSize * 0.9) + 'px'; // La figura ocupa casi todo el espacio
        target.innerHTML = icons[Math.floor(Math.random()*icons.length)];

        // Posici√≥n aleatoria
        const maxX = window.innerWidth - currentSize;
        const maxY = window.innerHeight - currentSize - 120;
        target.style.left = Math.random() * maxX + 'px';
        target.style.top = (Math.random() * maxY + 100) + 'px';

        startTimer();
    }

    function startTimer() {
        let duration = Math.max(700, 4000 - (level * 200)); // Empieza con 4 seg, baja por nivel
        timeLeft = 100;
        const bar = document.getElementById('timer-bar');
        
        const step = 100 / (duration / 50);
        timerInterval = setInterval(() => {
            timeLeft -= step;
            bar.style.width = timeLeft + "%";
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                miss();
            }
        }, 50);
    }

    function hit() {
        hits++;
        if (hits % 5 === 0) {
            level++;
            document.getElementById('lvl').innerText = level;
        }
        spawn();
    }

    function miss() {
        lives--;
        updateLives();
        if (lives <= 0) endGame();
        else spawn();
    }

    function updateLives() {
        document.getElementById('lives-container').innerText = "‚ù§Ô∏è".repeat(lives) + "üñ§".repeat(3 - lives);
    }

    function endGame() {
        clearInterval(timerInterval);
        document.getElementById('target').style.display = 'none';
        document.getElementById('end-screen').style.display = 'flex';
        
        let rec = "";
        if (level > 10) rec = "Excelente agudeza din√°mica y fijaci√≥n. Logra detectar est√≠mulos m√≠nimos.";
        else if (level > 5) rec = "Progreso adecuado. Se recomienda continuar para estabilizar fijaci√≥n en tama√±os peque√±os.";
        else rec = "Se observa fatiga o baja atenci√≥n visual. Fortalecer fijaci√≥n con est√≠mulos de gran tama√±o.";

        document.getElementById('resumen').innerText = rec;

        fetch(WEBAPP_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify({
                paciente: localStorage.getItem('paciente') || "An√≥nimo",
                juego: "Alto Contraste Infinito",
                puntuacion: hits,
                nivel: level,
                recomendacion: rec
            })
        });
    }
</script>
</body>
</html>


