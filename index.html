<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alto Contraste Pedi谩trico - Centro Perceptum</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Montserrat', sans-serif; overflow: hidden; touch-action: none; }
        
        /* Pantalla de Inicio */
        #start-screen { position: fixed; inset: 0; background: #1e293b; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .header-box { background: #38bdf8; color: #000; padding: 20px 40px; border-radius: 30px; margin-bottom: 20px; }
        .instructions { background: #0f172a; padding: 30px; border-radius: 30px; max-width: 500px; border: 2px solid #38bdf8; }
        .btn-play { background: #10b981; color: white; border: none; padding: 20px 50px; border-radius: 20px; font-weight: 900; font-size: 1.5rem; cursor: pointer; margin-top: 30px; box-shadow: 0 8px 0 #065f46; transition: 0.2s; }
        .btn-play:active { transform: translateY(4px); box-shadow: 0 2px 0 #065f46; }

        /* rea de Juego */
        #game-container { position: relative; width: 100vw; height: 100vh; display: none; }
        #target { position: absolute; cursor: pointer; transition: transform 0.2s; user-select: none; display: flex; align-items: center; justify-content: center; background: white; border-radius: 30px; }
        
        /* UI */
        .stat-badge { position: fixed; top: 20px; left: 20px; background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 15px; font-size: 1rem; border: 1px solid #38bdf8; z-index: 50; }
        #next-level-btn { position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%); background: #facc15; color: #000; border: none; padding: 20px 40px; border-radius: 50px; font-weight: 900; font-size: 1.2rem; cursor: pointer; display: none; z-index: 60; animation: bounce 2s infinite; }

        @keyframes bounce { 0%, 100% { transform: translateX(-50%) scale(1); } 50% { transform: translateX(-50%) scale(1.1); } }

        /* Pantalla Final */
        #end-screen { position: fixed; inset: 0; background: #0f172a; z-index: 200; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .recommendation { background: #38bdf8; color: #000; padding: 25px; border-radius: 25px; margin: 20px; font-weight: 700; max-width: 600px; line-height: 1.4; }
    </style>
</head>
<body>

<div id="start-screen">
    <div class="header-box"><h1>CENTRO PERCEPTUM</h1></div>
    <div class="instructions">
        <h2 style="color:#38bdf8">ALTO CONTRASTE PEDITRICO</h2>
        <p><b>Habilidades:</b> Fijaci贸n central, Agudeza visual b谩sica y Atenci贸n focalizada.</p>
        <p><b>Instrucci贸n:</b> Toca las figuras blancas que aparecen. El tama帽o ir谩 disminuyendo para trabajar la precisi贸n.</p>
    </div>
    <button class="btn-play" onclick="startGame()">隆EMPEZAR!</button>
</div>

<div id="game-container">
    <div class="stat-badge">Nivel: <span id="lvl-txt">1</span> | Capturas: <span id="hits-txt">0</span></div>
    <div id="target" onclick="hitTarget()"></div>
    <button id="next-level-btn" onclick="nextLevel()">隆SIGUIENTE NIVEL! </button>
</div>

<div id="end-screen">
    <h1 style="font-size: 3rem; color: #facc15;">隆SESIN COMPLETADA!</h1>
    <div class="recommendation" id="recommendation-msg"></div>
    <button class="btn-play" onclick="window.location.reload()">REPETIR</button>
</div>

<script>
    let hits = 0;
    let level = 1;
    let targetSize = 250;
    const icons = ['', '', '', '', '', '猸锔', '', '', '', '', '', ''];
    
    // Tu URL Maestra de Google Sheets
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzZca1mPz6VPxF9fjyL4kWNup_TR9ULFXQCkB1a6BtxZRf3HgVjAjOsmQz2QnGMtPMAw/exec"; 

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-container').style.display = 'block';
        spawnTarget();
    }

    function spawnTarget() {
        const target = document.getElementById('target');
        const img = icons[Math.floor(Math.random() * icons.length)];
        
        target.style.width = targetSize + 'px';
        target.style.height = targetSize + 'px';
        target.innerHTML = `<span style="font-size: ${targetSize * 0.7}px">${img}</span>`;
        
        const maxX = window.innerWidth - targetSize;
        const maxY = window.innerHeight - targetSize;
        
        target.style.left = Math.random() * maxX + 'px';
        target.style.top = Math.random() * maxY + 'px';
        
        target.style.transform = "scale(0)";
        setTimeout(() => target.style.transform = "scale(1)", 50);
    }

    function hitTarget() {
        hits++;
        document.getElementById('hits-txt').innerText = hits;
        
        if (hits % 5 === 0) {
            document.getElementById('next-level-btn').style.display = 'block';
            document.getElementById('target').style.display = 'none';
        } else {
            spawnTarget();
        }
    }

    function nextLevel() {
        level++;
        targetSize = Math.max(70, targetSize - 40); // Se achica cada nivel
        document.getElementById('lvl-txt').innerText = level;
        document.getElementById('next-level-btn').style.display = 'none';
        document.getElementById('target').style.display = 'flex';
        
        if (level > 6) finishGame();
        else spawnTarget();
    }

    function finishGame() {
        document.getElementById('game-container').style.display = 'none';
        document.getElementById('end-screen').style.display = 'flex';
        
        let msg = "";
        if (level >= 6) msg = "Excelente control visual. El paciente logra fijaci贸n foveal en est铆mulos peque帽os. Se recomienda iniciar seguimientos de color.";
        else if (level >= 3) msg = "Buen progreso. Logra captar figuras medianas con estabilidad. Se sugiere repetir para ganar precisi贸n en tama帽os menores.";
        else msg = "Atenci贸n inicial detectada. Se recomienda realizar sesiones cortas para fortalecer la fijaci贸n antes de aumentar la dificultad.";
        
        document.getElementById('recommendation-msg').innerText = msg;
        
        const data = {
            paciente: localStorage.getItem('paciente') || 'Anonimo',
            juego: "Alto Contraste Pedi谩trico",
            puntuacion: hits,
            nivel: level,
            recomendacion: msg
        };

        fetch(WEBAPP_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
    }
</script>
</body>
</html>
